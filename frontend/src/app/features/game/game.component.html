<p-toast key="game" position="top-right"></p-toast>
@if (vm(); as state) {
  <div class="game-container">
    @if (state.loading) {
      <div class="loading-container">
        <p-progressSpinner></p-progressSpinner>
      </div>
    }

    @if (!state.loading && state.game; as game) {
      <div class="game-content">
        <div class="players-section">
          <app-game-user-profile 
            [user]="currentUser$ | async"
            [game]="game"
            [remainingSeconds]="remainingSeconds()"
            [isActiveTurn]="isCurrentPlayerTurn(game)"
            [gameId]="game.gameId"
            [onSurrender]="surrender.bind(this)">
          </app-game-user-profile>
          
          <div class="vs-divider">
            <span class="vs-text">VS</span>
            <div class="vs-points">
              {{ translate.translate('game.pvp.points') }}: +{{ getPointsAtStake(game) }}
            </div>
          </div>
          
          @if (game.gameType === 'pvp') {
            <app-game-user-profile 
              [user]="opponentUser()"
              [game]="game"
              [remainingSeconds]="remainingSeconds()"
              [isActiveTurn]="isOpponentTurn(game)"
              [gameId]="null"
              [onSurrender]="null">
            </app-game-user-profile>
          } @else {
            <app-game-bot-info [game]="game"></app-game-bot-info>
          }
        </div>

        <div class="game-board-container">
          <app-game-board
            [boardSize]="game.boardSize"
            [boardState]="game.boardState"
            [currentPlayerSymbol]="game.currentPlayerSymbol"
            [disabled]="isMoveDisabled(game)"
            [gameStatus]="game.status"
            [gameType]="game.gameType"
            [winningCells]="winningCells()"
            (move)="onMove($event, game)">
          </app-game-board>
        </div>

        <app-game-result-dialog
          [visible]="showResult()"
          [game]="game"
          [currentUser]="currentUser$ | async"
          [pointsAtStake]="getPointsAtStake(game)"
          [drawPoints]="getDrawPoints(game)"
          (close)="onResultDialogClose()">
        </app-game-result-dialog>
      </div>
    }
  </div>
}


