<p-toast position="top-right"></p-toast>

<div class="matchmaking-queue-wrapper">
  <div class="matchmaking-queue-card">
    <div class="matchmaking-queue-container">
      <div class="matchmaking-queue-header">
        <div class="header-content">
          <div class="header-text">
            <h1>{{ translateService.translate('queue.title') }}</h1>
            <p class="subtitle">{{ translateService.translate('queue.subtitle') }}</p>
          </div>
        </div>
      </div>

      <div class="content-wrapper" [class.loading]="isLoading()">
        @if (isLoading() && !queueStatus()) {
          <div class="loading-container">
            <p-progressSpinner [style]="{ width: '50px', height: '50px' }"></p-progressSpinner>
          </div>
        } @else {
          @if (hasPlayers()) {
            <div class="queue-stats">
              <p>{{ translateService.translate('queue.totalPlayers') }}: <strong>{{ totalCount() }}</strong></p>
            </div>

            <div class="queue-table-wrapper">
              @if (isLoading()) {
                <div class="loading-overlay">
                  <p-progressSpinner [style]="{ width: '40px', height: '40px' }"></p-progressSpinner>
                </div>
              }
              <table class="queue-table">
                <thead>
                  <tr>
                    <th>{{ translateService.translate('queue.table.username') }}</th>
                    <th>{{ translateService.translate('queue.table.status') }}</th>
                    <th>{{ translateService.translate('queue.table.boardSize') }}</th>
                    <th>{{ translateService.translate('queue.table.ranking') }}</th>
                    <th>{{ translateService.translate('queue.table.actions') }}</th>
                  </tr>
                </thead>
                <tbody>
                  @for (player of players(); track trackByUserId($index, player)) {
                    <tr [@fadeInOut]>
                      <td class="username-cell">{{ player.username }}</td>
                      <td class="status-cell">
                        <p-tag
                          [value]="translateService.translate(getStatusLabel(player.status))"
                          [severity]="getStatusSeverity(player.status)"
                        ></p-tag>
                      </td>
                      <td class="board-size-cell">{{ getBoardSizeLabel(player.boardSize) }}</td>
                      <td class="ranking-cell">{{ formatScore(player.score) }}</td>
                      <td class="actions-cell">
                        @if (canJoinGame(player)) {
                          <button
                            type="button"
                            class="join-game-btn"
                            (click)="joinGame(player)"
                            [disabled]="isJoining()"
                            [attr.aria-label]="translateService.translate('queue.join') + ' ' + player.username"
                          >
                            @if (isJoining()) {
                              <span class="btn-loading">{{ translateService.translate('queue.join') }}...</span>
                            } @else {
                              {{ translateService.translate('queue.join') }}
                            }
                          </button>
                        } @else {
                          <span class="no-action">-</span>
                        }
                      </td>
                    </tr>
                  }
                </tbody>
              </table>
            </div>
          } @else {
            <div class="empty-queue">
              <p>{{ translateService.translate('queue.empty') }}</p>
            </div>
          }
        }
      </div>
    </div>
  </div>
</div>

