<p-toast key="game-avatar" position="top-right"></p-toast>

@if (user; as userData) {
  <div class="game-user-profile" [class.guest-user]="userData.isGuest">
    <div class="profile-content">
      <div class="avatar-section">
        <div class="profile-name">{{ displayName() }}</div>
        <div class="avatar-wrapper">
          <div class="avatar-container">
            <img [src]="avatarPath()" alt="Avatar" class="avatar-image" />
          </div>
          @if (canEditAvatar()) {
            <button
              pButton
              type="button"
              class="avatar-edit-button"
              icon="pi pi-pencil"
              [pTooltip]="translate.translate('profile.avatar.edit')"
              tooltipPosition="top"
              size="small"
              (click)="onEditAvatar()"
              [title]="translate.translate('profile.avatar.edit')"
              aria-label="Edit avatar">
            </button>
          }
        </div>
      </div>
      @if (!userData.isGuest) {
        <div class="stats-section">
          <div class="stat-item">
            <span class="stat-label">{{ translate.translate('profile.stats.points') }}</span>
            <span class="stat-value">{{ userData.totalPoints || 0 }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">{{ translate.translate('profile.stats.gamesPlayed') }}</span>
            <span class="stat-value">{{ userData.gamesPlayed || 0 }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">{{ translate.translate('profile.stats.gamesWon') }}</span>
            <span class="stat-value">{{ userData.gamesWon || 0 }}</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">{{ translate.translate('profile.stats.winRate') }}</span>
            <span class="stat-value">{{ winRate() }}%</span>
          </div>
        </div>
      }
      
      @if (playerSymbol(); as symbol) {
        <div class="symbol-section">
          <div class="player-symbol" [class.symbol-x]="symbol.toLowerCase() === 'x'" [class.symbol-o]="symbol.toLowerCase() === 'o'">
            <span class="symbol-value">{{ symbol.toUpperCase() }}</span>
          </div>
          @if (hasRanking() && ranking; as rankingData) {
            <div class="ranking-position">
              <span class="ranking-label">#{{ rankingData.rankPosition }}</span>
            </div>
          }
        </div>
      }
      
      @if (userData.isGuest && isCurrentUser()) {
        <div class="guest-info-column">
          <div class="guest-info">
            <i class="pi pi-exclamation-triangle guest-icon"></i>
            <p>{{ translate.translate('profile.guest.info') }}</p>
            <a routerLink="/auth/register" class="register-link">
              {{ translate.translate('profile.registerButton') }}
            </a>
          </div>
        </div>
      }
      
    </div>
  </div>

  @if (showAvatarDialog() && user) {
    <app-avatar-selector
      [visible]="showAvatarDialog()"
      [currentAvatar]="user.avatar"
      [isLoading]="isSavingAvatar()"
      (visibleChange)="onAvatarDialogVisibleChange($event)"
      (close)="onCloseAvatarDialog()"
      (save)="onSaveAvatar($event)">
    </app-avatar-selector>
  }
}

